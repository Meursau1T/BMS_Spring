<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title> 图书管理系统 </title>

    <script th:src="@{/js/jquery.min.js}" ></script>
    <script th:src="@{/js/afquery.js}" ></script>
    <link rel="stylesheet" th:href="@{/css/common.css}" />
    <link rel="stylesheet" th:href="@{/css/main.css}" />
    <!-- layer.js 对话框API -->
    <script th:src="@{/layer/layer.js}" ></script>

    <style>
        .header{
            padding: 10px;
            background: linear-gradient(to bottom, lightskyblue, #7dbedc 30%);
            height: 70px;


        }

        .search{
            width: 200px;
            height: 30px;
            position: absolute;
            left: 900px;
            top: 40px;
        }
        .search-icon{
            height: 20px;
            width: 20px;
            position: relative;
            left: 180px;
            top: -25px;
        }
        .user-thumbnail{
            position: absolute;
            left: 1250px;
        }
        .preferredFont{
            font-family: Menlo,Monaco,Consolas,"Courier New",monospace;
            color: #333;
        }
        .registerContainer{
            margin-top: 50px;
            width: 500px;
            height: 600px;
            background-color:white;
            line-height: 20px;
            text-align: center;
            border: 1px solid rgba(187, 187, 187, 100);
            border-radius: 5px;
            box-shadow: 10px 10px 5px #888888;
        }

    </style>


</head>
<body th:background="@{/img/background.png}">
<div th:include="~{common::header}"></div>
<div class="registerContainer center">
    <div class='form' style='padding: 40px;'>
        <div class='pad' style='margin-bottom: 30px;font-size:110%'>
            新 用 户 注 册
        </div>
        <div class='pad'>
            <input class='userID' type='text' placeholder="账号" required>
        </div>
        <div class='pad'>
            <input class='name' type='text' placeholder="用户名" required>
        </div>
        <div class='pad'>
            <input class='sex' type='text' placeholder="性别" list="choice" required>
            <datalist id="choice">
                <option value="男"></option>
                <option value="女"></option>
            </datalist>
        </div>
        <div class='pad' >
            <input class='birth' type='date' placeholder="生日" required>
        </div>
        <div class='pad'>
            <input class='tel' type='tel' placeholder="电话" required>
        </div>
        <div class='pad'>
            <input class='password' type='password' placeholder="密码" required>
        </div>
        <div class="pad">
            <input type='file' class='file' style='display:none' />

            <button onclick='my.upload()'> 上传图片 </button> <br><br>


        </div>

        <div class="pad" style="height: 35px;">
            <img th:src="@{/code}" th:id="identity"  style="width:100px;">
            <input type="button"  value="更换验证码" onclick="my.change()" id="btn"
                   style="font-size: 14px;position: relative;top: -7px" >
        </div>
        <div class="pad" style="position: relative;left: 17px">
            <input class="code" type="text" placeholder="请输入验证码">
            <input type="button" value="验证" onclick="my.verify()"
                   style="font-size: 14px;position: relative;left: -43px">
        </div>
        <div class='pad' >
            <button class='primary' onclick='my.register()'> 注 册 </button>
        </div>
    </div>

</div>

<div class='preview'  onload="my.init()" style="width: 200px;height: 250px;  position:absolute;left: 1050px;top: 400px;">
    <img src='' id="preview" width="200px" height="250px" alt=""  style="border: 0px;display: none" >
</div>

</body>

<script>
    var my = {};
    var isrigh=false;

    my.change=function ()
    {
        var des='[[@{/code}]]';
        document.getElementById('identity').src=des+"?ts="+new Date().getTime();

    }
    my.verify= function ()
    {
        var req = {};
        req.code = $('.form .code').val().trim();
        Af.rest('[[@{/code.do}]]', req, function(data){
            layer.msg ('正确',{
                time:1000,
                end: function(){
                    isrigh=true;

                }
            })
        },function (data1,data2){
            layer.msg ('验证错误',{
                time:1000,
                end: function(){
                    isrigh=false;
                    my.change();
                }
            })
        })
    }
    my.search=function ()
    {
        var req={};

        req.keyWord=$('.search .search-info').val().trim();
        alert(req.keyWord);
        Af.rest('[[@{/book/search}]]', req, function(data){
                location.href='[[@{/book/list}]]';
            }
        )
    }
    var up = new AfUploader();
    up.setButton('.file');  // 指定<file>元素
    up.setUploadUrl('[[@{/photo/upload.do}]]'); // 可以使用thymeleaf表达式
    // 事件处理 'start' 'progress' 'complete' 'error' 'abort'
    up.processEvent = function(event)
    {
        if(event == 'progress')
        {
            // this.progress 表示进度
            $('.note').html(this.progress + '%');
        }
        else if(event == 'complete')
        {

            var result = JSON.parse(this.response);
            var imageUrl = result.data.url;
            $('.preview img').attr('src', imageUrl);
           document.getElementById('preview').style.display="block";
        }
    };

    // 是否允许上传
    up.beforeUpload = function(){
        if(this.file.size > 10*1000000)
        {
            alert("文件太大!");
            return false;
        }
        return true;
    };

    my.upload = function(){
        // 选择文件，并上传
        up.openFileDialog();
    }
    my.init=function (){
        document.getElementById('preview').style.display="none";
    }
    my.register=function (){
        if(isrigh==true) {
            var req={};
            req.id = $('.form .userID').val().trim();
            req.name = $('.form .name').val().trim();
            req.sex = $('.form .sex').val().trim();
            req.birth = $('.form .birth').val().trim();
            req.tel = $('.form .tel').val().trim();
            req.password = $('.form .password').val().trim();
            Af.rest('[[@{/register.do}]]', req, function (data) {
                layer.msg('注册成功', {
                    time: 1000,
                    end: function () {
                        location.href = '[[@{/borrower/info}]]';
                    }
                })
            },function (data1,data2){
                layer.msg ('该用户id已注册',{
                    time:1000,
                    end: function(){
                        isrigh=false;
                        my.change();
                    }
                })
            })
        }
        else {
            layer.msg ('请输入验证码',{
                    time:1000,
                    end:function (){

                    }
                }
            )
        }

    }
</script>

</html>
